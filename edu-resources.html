<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Resources - Archalo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #d4a574 0%, #8b6f47 100%);
            min-height: 100vh;
        }
        
        /* Navigation */
        nav {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }
        
        .logo {
            color: #ecf0f1;
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: clamp(1rem, 3vw, 2rem);
        }
        
        .nav-links a {
            color: #ecf0f1;
            text-decoration: none;
            font-weight: 500;
            font-size: clamp(0.9rem, 2vw, 1rem);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
            background-color: rgba(52, 152, 219, 0.2);
            color: #3498db;
            transform: translateY(-1px);
        }
        
        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0.5rem;
        }
        
        .hamburger span {
            width: 25px;
            height: 3px;
            background-color: #ecf0f1;
            margin: 3px 0;
            transition: all 0.3s ease;
            border-radius: 2px;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }
        
        /* Header Section */
        .header-section {
            text-align: center;
            padding: 3rem 2rem;
            color: white;
        }
        
        .header-section h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header-section p {
            font-size: clamp(1rem, 2vw, 1.3rem);
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.95;
        }
        
        /* Resources Container */
        .resources-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        /* Resource Card */
        .resource-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .resource-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .resource-card h3 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }
        
        .resource-card .resource-preview {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .resource-card .read-more {
            color: #8b6f47;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Admin Buttons on Cards */
        .admin-controls {
            display: none;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .admin-controls.show {
            display: flex;
        }
        
        .admin-controls button {
            flex: 1;
            padding: 0.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .edit-btn {
            background: #3498db;
            color: white;
        }
        
        .edit-btn:hover {
            background: #2980b9;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-close {
            float: right;
            font-size: 2rem;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            background: none;
            border: none;
            transition: color 0.3s ease;
        }
        
        .modal-close:hover {
            color: #000;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #8b6f47;
        }
        
        .form-group textarea {
            min-height: 300px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .form-group small {
            display: block;
            margin-top: 0.25rem;
            color: #666;
            font-size: 0.85rem;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #d4704a, #c0603c);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Footer */
        footer {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
            padding: 2rem 1rem;
            margin-top: 3rem;
            text-align: center;
        }
        
        .footer-disclaimer {
            max-width: 900px;
            margin: 0 auto 1rem;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #bdc3c7;
        }
        
        .admin-link {
            color: #bdc3c7;
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px dotted transparent;
        }
        
        .admin-link:hover {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        
        /* Markdown Content Styles */
        .markdown-content {
            line-height: 1.8;
            color: #2c3e50;
        }
        
        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #2c3e50;
        }
        
        .markdown-content h1 {
            font-size: 2rem;
            border-bottom: 2px solid #8b6f47;
            padding-bottom: 0.5rem;
        }
        
        .markdown-content h2 {
            font-size: 1.5rem;
        }
        
        .markdown-content h3 {
            font-size: 1.2rem;
        }
        
        .markdown-content p {
            margin-bottom: 1rem;
        }
        
        .markdown-content ul,
        .markdown-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        .markdown-content code {
            background: #f4f4f4;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .markdown-content pre {
            background: #f4f4f4;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        .markdown-content blockquote {
            border-left: 4px solid #8b6f47;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }
        
        .markdown-content a {
            color: #8b6f47;
            text-decoration: none;
        }
        
        .markdown-content a:hover {
            text-decoration: underline;
        }
        
        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        /* Success/Error Messages */
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
            
            .nav-links {
                position: fixed;
                left: -100%;
                top: 70px;
                flex-direction: column;
                background: linear-gradient(135deg, #2c3e50, #34495e);
                width: 100%;
                text-align: center;
                transition: left 0.3s ease;
                box-shadow: 0 10px 27px rgba(0,0,0,0.3);
                padding: 1rem 0;
                gap: 0;
            }
            
            .nav-links.active {
                left: 0;
            }
            
            .nav-links li {
                padding: 0.5rem 0;
                width: 100%;
            }
            
            .nav-links a {
                display: block;
                padding: 1rem;
                width: 100%;
            }
            
            .resources-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
        }
    </style>
    
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="Archalo.html" style="text-decoration: none; color: inherit;">
                <div class="logo">Archalo</div>
            </a>
            <button class="hamburger" id="hamburger" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="Archalo.html">Home</a></li>
                <li><a href="laws.html">Laws</a></li>
                <li><a href="artifactHelp.html">I Found an Artifact</a></li>
                <li><a href="edu-resources.html" class="active">Educational Resources</a></li>
            </ul>
        </div>
    </nav>

    <div class="header-section">
        <h1>üìö Educational Resources</h1>
        <p>Explore comprehensive guides, tutorials, and educational materials about archaeological preservation and heritage protection</p>
    </div>

    <div class="resources-container">
        <div class="resources-grid" id="resourcesGrid">
            <!-- Resources will be dynamically loaded here -->
            <div class="resource-card" style="text-align: center; color: #999;">
                <div class="resource-icon">üîç</div>
                <h3>Loading Resources...</h3>
                <p class="resource-preview">Please wait while we fetch educational content.</p>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAdminModal()">&times;</button>
            
            <!-- Login Form -->
            <div id="adminLoginForm">
                <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Admin Login</h2>
                <div class="form-group">
                    <label for="adminEmail">Email</label>
                    <input type="email" id="adminEmail" placeholder="Enter admin email" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter password" required>
                </div>
                <button id="loginBtn" class="submit-btn">Login</button>
            </div>
            
            <!-- Admin Panel (shown after login) -->
            <div id="adminPanelContent" style="display: none;">
                <div style="background-color: #e8f5e9; border: 1px solid #81c784; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                    <p style="margin: 0.5rem 0; color: #2e7d32;"><strong>üë§ Logged in as:</strong> <span id="userEmail"></span></p>
                    <button id="logoutBtn" style="background-color: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; margin-top: 0.5rem;">
                        Logout
                    </button>
                </div>
                
                <!-- Add/Edit Resource Form -->
                <div id="resourceForm">
                    <h2 style="color: #2c3e50; margin-bottom: 1.5rem;" id="formTitle">Add New Resource</h2>
                    <input type="hidden" id="editResourceId">
                    
                    <div class="form-group">
                        <label for="resourceIcon">Icon (emoji)</label>
                        <input type="text" id="resourceIcon" placeholder="e.g., üìñ, üèõÔ∏è, üî¨" maxlength="4" required>
                        <small>Choose an emoji that represents this resource</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceTitle">Title</label>
                        <input type="text" id="resourceTitle" placeholder="Resource title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceContent">Content (Markdown)</label>
                        <textarea id="resourceContent" placeholder="Enter content using Markdown formatting...

# Main Heading
## Subheading
- Bullet point
1. Numbered list
**bold** *italic*
[Link text](URL)
![Image](URL)
" required></textarea>
                        <small>You can use Markdown syntax. The first paragraph will be shown as preview on the card.</small>
                    </div>
                    
                    <button onclick="submitResource()" class="submit-btn" id="submitBtn">Add Resource</button>
                    <button onclick="cancelEdit()" class="submit-btn" id="cancelBtn" style="display: none; background: #95a5a6; margin-top: 0.5rem;">Cancel Edit</button>
                    
                    <div id="submitMessage" style="margin-top: 1rem;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resource Detail Modal -->
    <div id="resourceModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeResourceModal()">&times;</button>
            <div id="resourceDetailContent" class="markdown-content">
                <!-- Resource details will be displayed here -->
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-disclaimer">
            <p><strong>Disclaimer:</strong> We strive to provide the most accurate data available, however, we cannot guarantee its completeness or accuracy. Our guidance is advisory only. We are not responsible for any consequences resulting from the use of this information. Always verify with authorities.</p>
        </div>
        <a href="#" class="admin-link" id="adminLoginBtn">Login</a>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, setDoc, getDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCCYpXOczp5nRRP1S2Gdb1ADjIAHeJQVq0",
            authDomain: "owlcheologists.firebaseapp.com",
            projectId: "owlcheologists",
            storageBucket: "owlcheologists.firebasestorage.app",
            messagingSenderId: "323297596743",
            appId: "1:323297596743:web:c9455e40779b7c09522862",
            measurementId: "G-2CFYWTQCQ4"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let isAuthenticated = false;
        let currentUser = null;

        // Authentication state listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                isAuthenticated = true;
                currentUser = user;
                showAdminControls();
            } else {
                isAuthenticated = false;
                currentUser = null;
                hideAdminControls();
            }
        });

        // Open admin modal
        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'flex';
            if (isAuthenticated) {
                showAdminPanel({ email: currentUser.email });
            } else {
                showLoginForm();
            }
        }

        // Close admin modal
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            cancelEdit();
        }

        // Show login form
        function showLoginForm() {
            document.getElementById('adminLoginForm').style.display = 'block';
            document.getElementById('adminPanelContent').style.display = 'none';
        }

        // Show admin panel
        function showAdminPanel(user) {
            document.getElementById('adminLoginForm').style.display = 'none';
            document.getElementById('adminPanelContent').style.display = 'block';
            document.getElementById('userEmail').textContent = user.email;
        }

        // Show admin controls on resource cards
        function showAdminControls() {
            document.querySelectorAll('.admin-controls').forEach(control => {
                control.classList.add('show');
            });
        }

        // Hide admin controls
        function hideAdminControls() {
            document.querySelectorAll('.admin-controls').forEach(control => {
                control.classList.remove('show');
            });
        }

        // Login functionality
        document.addEventListener('DOMContentLoaded', function() {
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', async function() {
                    const email = document.getElementById('adminEmail').value.trim();
                    const password = document.getElementById('adminPassword').value.trim();

                    if (!email || !password) {
                        alert('Please enter both email and password');
                        return;
                    }

                    try {
                        await signInWithEmailAndPassword(auth, email, password);
                        showAdminPanel({ email });
                        document.getElementById('adminEmail').value = '';
                        document.getElementById('adminPassword').value = '';
                    } catch (error) {
                        console.error('Login error:', error);
                        alert('Login failed: ' + error.message);
                    }
                });
            }

            // Logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async function() {
                    try {
                        await signOut(auth);
                        showLoginForm();
                    } catch (error) {
                        console.error('Logout error:', error);
                        alert('Logout failed');
                    }
                });
            }

            // Admin modal controls
            const adminLoginBtn = document.getElementById('adminLoginBtn');
            if (adminLoginBtn) {
                adminLoginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openAdminModal();
                });
            }
        });

        // Load resources
        async function loadResources() {
            try {
                const resourcesRef = collection(db, 'educationalResources');
                const q = query(resourcesRef, orderBy('dateAdded', 'desc'));
                const snapshot = await getDocs(q);
                
                const resourcesGrid = document.getElementById('resourcesGrid');
                resourcesGrid.innerHTML = '';

                if (snapshot.empty) {
                    resourcesGrid.innerHTML = `
                        <div class="resource-card" style="text-align: center; color: #999;">
                            <div class="resource-icon">üìö</div>
                            <h3>No Resources Yet</h3>
                            <p class="resource-preview">Admin can add educational resources using the Admin button in the footer.</p>
                        </div>
                    `;
                    return;
                }

                snapshot.forEach((doc) => {
                    const resource = doc.data();
                    const preview = extractPreview(resource.content);
                    
                    const card = document.createElement('div');
                    card.className = 'resource-card';
                    card.innerHTML = `
                        <div class="resource-icon">${resource.icon || 'üìñ'}</div>
                        <h3>${resource.title}</h3>
                        <p class="resource-preview">${preview}</p>
                        <span class="read-more">Read more ‚Üí</span>
                        <div class="admin-controls ${isAuthenticated ? 'show' : ''}">
                            <button class="edit-btn" onclick="editResource('${doc.id}')">‚úèÔ∏è Edit</button>
                            <button class="delete-btn" onclick="deleteResource('${doc.id}')">üóëÔ∏è Delete</button>
                        </div>
                    `;
                    
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.admin-controls')) {
                            viewResource(doc.id);
                        }
                    });
                    
                    resourcesGrid.appendChild(card);
                });

            } catch (error) {
                console.error('Error loading resources:', error);
                document.getElementById('resourcesGrid').innerHTML = `
                    <div class="resource-card" style="text-align: center; color: #e74c3c;">
                        <div class="resource-icon">‚ö†Ô∏è</div>
                        <h3>Error Loading Resources</h3>
                        <p class="resource-preview">Please try refreshing the page.</p>
                    </div>
                `;
            }
        }

        // Extract preview from markdown content
        function extractPreview(content) {
            // Remove markdown syntax and get first paragraph
            const plainText = content
                .replace(/^#+\s+/gm, '') // Remove headers
                .replace(/\*\*(.+?)\*\*/g, '$1') // Remove bold
                .replace(/\*(.+?)\*/g, '$1') // Remove italic
                .replace(/\[(.+?)\]\(.+?\)/g, '$1') // Remove links
                .replace(/`(.+?)`/g, '$1') // Remove code
                .trim();
            
            const firstParagraph = plainText.split('\n\n')[0];
            return firstParagraph.length > 150 
                ? firstParagraph.substring(0, 150) + '...' 
                : firstParagraph;
        }

        // View resource details
        window.viewResource = async function(resourceId) {
            try {
                const resourceDoc = await getDoc(doc(db, 'educationalResources', resourceId));
                
                if (!resourceDoc.exists()) {
                    alert('Resource not found');
                    return;
                }

                const resource = resourceDoc.data();
                const htmlContent = marked.parse(resource.content);
                
                document.getElementById('resourceDetailContent').innerHTML = `
                    <div style="text-align: center; font-size: 3rem; margin-bottom: 1rem;">${resource.icon || 'üìñ'}</div>
                    <h1 style="color: #8b6f47; margin-bottom: 2rem;">${resource.title}</h1>
                    ${htmlContent}
                `;
                
                document.getElementById('resourceModal').style.display = 'flex';

            } catch (error) {
                console.error('Error viewing resource:', error);
                alert('Error loading resource details');
            }
        };

        // Close resource detail modal
        window.closeResourceModal = function() {
            document.getElementById('resourceModal').style.display = 'none';
        };

        // Submit resource (add or update)
        window.submitResource = async function() {
            if (!isAuthenticated) {
                alert('You must be logged in to add resources');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const messageDiv = document.getElementById('submitMessage');
            
            const icon = document.getElementById('resourceIcon').value.trim();
            const title = document.getElementById('resourceTitle').value.trim();
            const content = document.getElementById('resourceContent').value.trim();
            const resourceId = document.getElementById('editResourceId').value;

            if (!icon || !title || !content) {
                messageDiv.innerHTML = '<div class="error-message">Please fill in all required fields</div>';
                return;
            }

            try {
                submitBtn.disabled = true;
                submitBtn.textContent = resourceId ? 'Updating...' : 'Adding...';

                const resourceData = {
                    icon: icon,
                    title: title,
                    content: content,
                    lastModified: new Date().toISOString()
                };

                if (!resourceId) {
                    resourceData.dateAdded = new Date().toISOString();
                }

                const docId = resourceId || title.toLowerCase().replace(/[^a-z0-9]+/g, '-') + '-' + Date.now();
                await setDoc(doc(db, 'educationalResources', docId), resourceData, { merge: !!resourceId });

                messageDiv.innerHTML = `<div class="success-message">‚úì Resource ${resourceId ? 'updated' : 'added'} successfully!</div>`;

                setTimeout(() => {
                    closeAdminModal();
                    loadResources();
                    clearForm();
                }, 1500);

            } catch (error) {
                console.error('Error saving resource:', error);
                messageDiv.innerHTML = '<div class="error-message">Error saving resource. Please try again.</div>';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = resourceId ? 'Update Resource' : 'Add Resource';
            }
        };

        // Edit resource
        window.editResource = async function(resourceId) {
            if (!isAuthenticated) {
                alert('You must be logged in to edit resources');
                return;
            }

            try {
                const resourceDoc = await getDoc(doc(db, 'educationalResources', resourceId));
                
                if (!resourceDoc.exists()) {
                    alert('Resource not found');
                    return;
                }

                const resource = resourceDoc.data();
                
                document.getElementById('editResourceId').value = resourceId;
                document.getElementById('resourceIcon').value = resource.icon || '';
                document.getElementById('resourceTitle').value = resource.title || '';
                document.getElementById('resourceContent').value = resource.content || '';
                
                document.getElementById('formTitle').textContent = 'Edit Resource';
                document.getElementById('submitBtn').textContent = 'Update Resource';
                document.getElementById('cancelBtn').style.display = 'block';
                
                openAdminModal();

            } catch (error) {
                console.error('Error loading resource for edit:', error);
                alert('Error loading resource data');
            }
        };

        // Delete resource
        window.deleteResource = async function(resourceId) {
            if (!isAuthenticated) {
                alert('You must be logged in to delete resources');
                return;
            }

            if (!confirm('Are you sure you want to delete this resource? This action cannot be undone.')) {
                return;
            }

            try {
                await deleteDoc(doc(db, 'educationalResources', resourceId));
                alert('Resource deleted successfully!');
                loadResources();

            } catch (error) {
                console.error('Error deleting resource:', error);
                alert('Error deleting resource. Please try again.');
            }
        };

        // Cancel edit
        window.cancelEdit = function() {
            clearForm();
        };

        // Clear form
        function clearForm() {
            document.getElementById('editResourceId').value = '';
            document.getElementById('resourceIcon').value = '';
            document.getElementById('resourceTitle').value = '';
            document.getElementById('resourceContent').value = '';
            document.getElementById('formTitle').textContent = 'Add New Resource';
            document.getElementById('submitBtn').textContent = 'Add Resource';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('submitMessage').innerHTML = '';
        }

        // Make functions available globally
        window.openAdminModal = openAdminModal;
        window.closeAdminModal = closeAdminModal;

        // Load resources on page load
        loadResources();

        // Hamburger menu functionality
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        
        if (hamburger) {
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });
            
            // Close menu when clicking on a link
            const navLinkItems = navLinks.querySelectorAll('a');
            navLinkItems.forEach(link => {
                link.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                const isClickInsideNav = navLinks.contains(event.target);
                const isClickOnHamburger = hamburger.contains(event.target);
                
                if (!isClickInsideNav && !isClickOnHamburger && navLinks.classList.contains('active')) {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });
        }
    </script>
</body>
</html>
