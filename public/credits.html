<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credits & Attributions</title>
    <link rel="icon" type="image/png" href="owlcheologists.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f4f4f4;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }

        header h1 {
            font-size: 2.5rem;
        }

        .home-btn {
            position: absolute;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            text-decoration: none;
            padding: 0.5rem 1.25rem;
            border: 2px solid white;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 1rem;
        }

        .home-btn:hover {
            background: white;
            color: #2c3e50;
        }

        @media (max-width: 768px) {
            .home-btn {
                position: static;
                transform: none;
                display: inline-block;
                margin-bottom: 1rem;
            }

            header h1 {
                font-size: 2rem;
            }
        }

        main {
            flex: 1;
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
            width: 100%;
        }

        #content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 300px;
        }

        #content img {
            max-width: 100%;
            height: auto;
        }

        #editor-container {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        #editor-container.active {
            display: block;
        }

        textarea {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .editor-actions {
            margin-top: 1rem;
            display: flex;
            gap: 1rem;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        footer {
            background: #34495e;
            color: white;
            padding: 2rem 1.5rem;
            text-align: center;
            margin-top: auto;
        }

        .footer-disclaimer {
            max-width: 900px;
            margin: 0 auto 1.5rem;
            font-size: 0.9rem;
            line-height: 1.8;
        }

        .footer-disclaimer p {
            margin-bottom: 1rem;
        }

        .footer-disclaimer p:last-child {
            margin-bottom: 0;
        }

        .admin-link {
            display: inline-block;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1.5rem;
            border: 2px solid white;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .admin-link:hover {
            background: white;
            color: #34495e;
        }

        .admin-link.logged-in {
            border-color: #27ae60;
            background: #27ae60;
        }

        .admin-link.logged-in:hover {
            background: #229954;
            border-color: #229954;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .modal-content h2 {
            margin-bottom: 1.5rem;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .message {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.active {
            display: block;
        }

        .admin-badge {
            background: #27ae60;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <header>
        <h1>Credits & Attributions</h1>
                <a href="/index.html" style="text-decoration: none; color: inherit;">← Home</a>

    </header>

    <main>
        <div id="content" class="loading">
            <p>Loading content...</p>
        </div>

        <div id="editor-container">
            <h2>Edit Credits (Markdown)</h2>
            <div id="editorMessage" class="message"></div>
            <textarea id="markdownEditor" placeholder="Enter markdown content here..."></textarea>
            <div class="editor-actions">
                <button class="btn-primary" onclick="saveContent()">Save Changes</button>
                <button class="btn-secondary" onclick="cancelEdit()">Cancel</button>
            </div>

            <hr style="margin: 2rem 0; border: none; border-top: 2px solid #ddd;">

            <h2>Edit Announcements</h2>
            <div id="announcementMessage" class="message"></div>
            <div class="form-group">
                <label for="mainAnnouncement">Main Announcement</label>
                <textarea id="mainAnnouncement" 
                          placeholder="Enter main announcement text..." 
                          style="width: 100%; min-height: 150px; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
            </div>
            <div class="editor-actions">
                <button class="btn-primary" onclick="saveAnnouncement()">Save Announcement</button>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-disclaimer">
            <p><strong>Disclaimer:</strong> We strive to provide the most accurate and up-to-date data available; however, we cannot guarantee its completeness, accuracy, or fitness for any particular purpose. This guidance is advisory only and should never be relied upon as a substitute for official legal, regulatory, or professional advice. We assume no responsibility or liability for any losses, damages, or consequences resulting directly or indirectly from the use of this information. Users assume all risk and must always verify all information with the relevant governmental or legal authorities.</p>
        </div>
        <a href="#" id="adminLoginBtn" class="admin-link" style="border: none;" onclick="toggleAuth(); return false;">Login</a>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>Admin Login</h2>
            <div id="loginMessage" class="message"></div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="admin@example.com" value="admin@example.com">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter password">
            </div>
            <div class="editor-actions">
                <button class="btn-primary" onclick="login()">Login</button>
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCCYpXOczp5nRRP1S2Gdb1ADjIAHeJQVq0",
            authDomain: "owlcheologists.firebaseapp.com",
            projectId: "owlcheologists",
            storageBucket: "owlcheologists.firebasestorage.app",
            messagingSenderId: "323297596743",
            appId: "1:323297596743:web:c9455e40779b7c09522862",
            measurementId: "G-2CFYWTQCQ4"
        };

        // Check if Firebase is configured
        const isFirebaseConfigured = firebaseConfig.apiKey !== "YOUR_API_KEY";

        // Initialize Firebase
        let auth, db;
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        let currentUser = null;
        const ADMIN_EMAIL = 'admin@example.com';
        const CREDITS_DOC_ID = 'credits-content';
        const ARTIFACT_DOC_ID = 'current-artifact';
        const ANNOUNCEMENTS_DOC_ID = 'announcements';

        // Configure marked.js options
        if (typeof marked !== 'undefined') {
            marked.setOptions({
                breaks: true,
                gfm: true
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (!isFirebaseConfigured) {
                showConfigurationError();
            } else {
                loadContent();
                setupAuthListener();
            }
        });

        // Show configuration error
        function showConfigurationError() {
            const contentDiv = document.getElementById('content');
            contentDiv.className = '';
            contentDiv.innerHTML = `
                <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 1.5rem; border-radius: 4px; color: #856404;">
                    <h3 style="margin-bottom: 1rem;">⚠️ Firebase Not Configured</h3>
                    <p style="margin-bottom: 1rem;">Please configure Firebase to use this page:</p>
                    <ol style="margin-left: 1.5rem; line-height: 1.8;">
                        <li>Go to <a href="https://console.firebase.google.com" target="_blank" style="color: #0066cc;">Firebase Console</a></li>
                        <li>Create a new project or use an existing one</li>
                        <li>Enable Authentication (Email/Password)</li>
                        <li>Enable Firestore Database</li>
                        <li>Copy your Firebase config and replace the placeholder values in this file</li>
                    </ol>
                </div>
            `;
            document.getElementById('loginBtn').disabled = true;
        }

        // Auth state listener
        function setupAuthListener() {
            auth.onAuthStateChanged((user) => {
                currentUser = user;
                updateUIForAuth(user);
            });
        }

        // Update UI based on auth state
        function updateUIForAuth(user) {
            const loginBtn = document.getElementById('adminLoginBtn');
            const editorContainer = document.getElementById('editor-container');

            if (user && user.email === ADMIN_EMAIL) {
                loginBtn.textContent = 'Logout (Admin)';
                loginBtn.className = 'admin-link logged-in';
                loginBtn.onclick = function(e) { 
                    e.preventDefault(); 
                    logout(); 
                };
            } else {
                loginBtn.textContent = 'Login';
                loginBtn.className = 'admin-link';
                loginBtn.onclick = function(e) { 
                    e.preventDefault(); 
                    toggleAuth(); 
                };
                editorContainer.classList.remove('active');
            }
        }

        // Load content from Firestore
        async function loadContent() {
            const contentDiv = document.getElementById('content');
            
            if (!isFirebaseConfigured) {
                showConfigurationError();
                return;
            }

            try {
                const doc = await db.collection('credits').doc(CREDITS_DOC_ID).get();

                if (doc.exists) {
                    const markdown = doc.data().markdown || '';
                    contentDiv.className = '';
                    contentDiv.innerHTML = marked.parse(markdown);
                } else {
                    // Show default content when no document exists
                    contentDiv.className = '';
                    contentDiv.innerHTML = `
                        <h2>Credits & Attributions</h2>
                        <p><em>No credits content has been added yet. Admin can login to add content.</em></p>
                        <hr style="margin: 2rem 0;">
                        <h3>Sample Credits Template:</h3>
                        <ul>
                            <li><strong>Project Name</strong> - Description</li>
                            <li><strong>Libraries Used</strong> - Firebase, Marked.js</li>
                            <li><strong>Icons & Images</strong> - Attribution here</li>
                        </ul>
                    `;
                }
            } catch (error) {
                console.error('Error loading content:', error);
                contentDiv.className = '';
                
                // Provide more specific error messages
                let errorMessage = 'Error loading content. ';
                
                if (error.code === 'permission-denied') {
                    errorMessage += 'Please check your Firestore security rules. Make sure read access is allowed.';
                    errorMessage += '<br><br><strong>Suggested Firestore Rules:</strong><pre style="background: #f4f4f4; padding: 1rem; border-radius: 4px; overflow-x: auto;">rules_version = \'2\';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    match /credits/{document} {\n      allow read: if true;\n      allow write: if request.auth != null && request.auth.token.email == \'admin@example.com\';\n    }\n  }\n}</pre>';
                } else if (error.code === 'unavailable') {
                    errorMessage += 'Cannot connect to Firestore. Please check your internet connection.';
                } else {
                    errorMessage += `${error.message || 'Please try again later.'}`;
                }
                
                contentDiv.innerHTML = `
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 1.5rem; border-radius: 4px; color: #721c24;">
                        <h3 style="margin-bottom: 1rem;">${errorMessage}</h3>
                        <button class="btn-primary" onclick="loadContent()" style="margin-top: 1rem;">Retry</button>
                    </div>
                `;
            }
        }

        // Toggle auth modal
        function toggleAuth() {
            if (currentUser && currentUser.email === ADMIN_EMAIL) {
                showEditEditor();
            } else {
                document.getElementById('loginModal').classList.add('active');
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
            clearLoginForm();
        }

        // Clear login form
        function clearLoginForm() {
            document.getElementById('password').value = '';
            hideMessage('loginMessage');
        }

        // Login function
        async function login() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (email !== ADMIN_EMAIL) {
                showMessage('loginMessage', 'Only admin@example.com can login.', 'error');
                return;
            }

            if (!password) {
                showMessage('loginMessage', 'Please enter a password.', 'error');
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
                closeModal();
                showMessage('editorMessage', 'Successfully logged in!', 'success');
                showEditEditor();
            } catch (error) {
                console.error('Login error:', error);
                showMessage('loginMessage', error.message, 'error');
            }
        }

        // Logout function
        async function logout() {
            try {
                await auth.signOut();
                document.getElementById('editor-container').classList.remove('active');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Show edit editor
        async function showEditEditor() {
            if (!currentUser || currentUser.email !== ADMIN_EMAIL) {
                showMessage('loginMessage', 'Unauthorized access.', 'error');
                return;
            }

            try {
                const doc = await db.collection('credits').doc(CREDITS_DOC_ID).get();
                const editor = document.getElementById('markdownEditor');
                
                if (doc.exists) {
                    editor.value = doc.data().markdown || '';
                } else {
                    editor.value = '# Credits & Attributions\n\nAdd your credits here...';
                }

                // Load announcement too
                await loadAnnouncement();

                document.getElementById('editor-container').classList.add('active');
                editor.focus();
            } catch (error) {
                console.error('Error loading editor:', error);
                showMessage('editorMessage', 'Error loading editor content.', 'error');
            }
        }

        // Load announcement when editor opens
        async function loadAnnouncement() {
            try {
                const doc = await db.collection('config').doc(ANNOUNCEMENTS_DOC_ID).get();
                const textarea = document.getElementById('mainAnnouncement');
                
                if (doc.exists) {
                    textarea.value = doc.data().main || '';
                } else {
                    textarea.value = '';
                }
            } catch (error) {
                console.error('Error loading announcement:', error);
                showMessage('announcementMessage', 'Error loading announcement: ' + error.message, 'error');
            }
        }

        // Save content
        async function saveContent() {
            if (!currentUser || currentUser.email !== ADMIN_EMAIL) {
                showMessage('editorMessage', 'Unauthorized access.', 'error');
                return;
            }

            const markdown = document.getElementById('markdownEditor').value;

            try {
                await db.collection('credits').doc(CREDITS_DOC_ID).set({
                    markdown: markdown,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: currentUser.email
                });

                showMessage('editorMessage', 'Content saved successfully!', 'success');
                loadContent();
                
                setTimeout(() => {
                    hideMessage('editorMessage');
                }, 3000);
            } catch (error) {
                console.error('Error saving content:', error);
                showMessage('editorMessage', 'Error saving content: ' + error.message, 'error');
            }
        }

        // Save announcement
        async function saveAnnouncement() {
            if (!currentUser || currentUser.email !== ADMIN_EMAIL) {
                showMessage('announcementMessage', 'Unauthorized access.', 'error');
                return;
            }

            const mainText = document.getElementById('mainAnnouncement').value;

            try {
                await db.collection('config').doc(ANNOUNCEMENTS_DOC_ID).set({
                    main: mainText,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: currentUser.email
                });

                showMessage('announcementMessage', 'Announcement saved successfully!', 'success');
                
                setTimeout(() => {
                    hideMessage('announcementMessage');
                }, 3000);
            } catch (error) {
                console.error('Error saving announcement:', error);
                showMessage('announcementMessage', 'Error saving announcement: ' + error.message, 'error');
            }
        }

        // Cancel edit
        function cancelEdit() {
            document.getElementById('editor-container').classList.remove('active');
            hideMessage('editorMessage');
        }

        // Show message
        function showMessage(elementId, message, type) {
            const msgElement = document.getElementById(elementId);
            msgElement.textContent = message;
            msgElement.className = `message ${type} active`;
        }

        // Hide message
        function hideMessage(elementId) {
            const msgElement = document.getElementById(elementId);
            msgElement.className = 'message';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const loginModal = document.getElementById('loginModal');
            
            if (event.target === loginModal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
