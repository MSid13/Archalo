<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archalo - Archaeological Discovery Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
        }
        
        /* Navigation */
        nav {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }
        
        .logo {
            color: #ecf0f1;
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: clamp(1rem, 3vw, 2rem);
        }
        
        .nav-links a {
            color: #ecf0f1;
            text-decoration: none;
            font-weight: 500;
            font-size: clamp(0.9rem, 2vw, 1rem);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover {
            background-color: rgba(52, 152, 219, 0.2);
            color: #3498db;
            transform: translateY(-1px);
        }
        
        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0.5rem;
            z-index: 1001;
        }
        
        .hamburger span {
            width: 25px;
            height: 3px;
            background-color: #ecf0f1;
            margin: 3px 0;
            transition: all 0.3s ease;
            border-radius: 2px;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }
        
        /* Mobile menu toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: #ecf0f1;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Artifact of the day section */
        .artifact-of-day {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: clamp(2rem, 5vw, 4rem) 2rem;
            text-align: center;
        }
        
        .artifact-of-day h2 {
            color: #2c3e50;
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 2rem;
            font-weight: 700;
            letter-spacing: -1px;
        }
        
        .artifact-placeholder {
            max-width: 1000px;
            margin: 0 auto;
            padding: clamp(1.5rem, 4vw, 2.5rem);
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .artifact-placeholder p {
            color: #7f8c8d;
            font-style: italic;
            font-size: clamp(1rem, 2.5vw, 1.1rem);
        }
        
        .artifact-content {
            display: grid;
            grid-template-columns: minmax(250px, 1fr) 2fr;
            gap: clamp(1.5rem, 4vw, 3rem);
            align-items: center;
            text-align: left;
        }
        
        .artifact-image {
            width: 100%;
            max-width: 350px;
            height: clamp(200px, 25vw, 250px);
            object-fit: cover;
            border-radius: 12px;
            margin: 0 auto;
            display: block;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }
        
        .artifact-image:hover {
            transform: scale(1.02);
        }
        
        .artifact-info h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: clamp(1.3rem, 3vw, 1.8rem);
            font-weight: 600;
            line-height: 1.3;
        }
        
        .artifact-info p {
            color: #555;
            margin-bottom: 0.8rem;
            font-size: clamp(0.9rem, 2vw, 1rem);
            line-height: 1.6;
        }
        
        .artifact-info p strong {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .loading {
            color: #7f8c8d;
            font-style: italic;
            font-size: clamp(1rem, 2.5vw, 1.1rem);
        }
        
        /* Features section */
        .content {
            max-width: 1400px;
            margin: 0 auto;
            padding: clamp(3rem, 6vw, 5rem) 2rem;
        }

        /* Hero Content Section */
        .hero-content {
            text-align: center;
            margin-bottom: clamp(4rem, 8vw, 6rem);
        }

        .hero-content h2 {
            color: #2c3e50;
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            margin-bottom: 1.5rem;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .hero-description {
            color: #555;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            line-height: 1.7;
            max-width: 800px;
            margin: 0 auto 2.5rem;
        }

        .quick-actions {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            min-width: 200px;
            justify-content: center;
        }

        .cta-button.primary {
            background: linear-gradient(135deg, #d4704a, #c0603c);
            color: white;
            box-shadow: 0 4px 15px rgba(212, 112, 74, 0.3);
        }

        .cta-button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 112, 74, 0.4);
        }

        .cta-button.secondary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .cta-button.secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: clamp(1.5rem, 4vw, 2.5rem);
            margin-bottom: clamp(4rem, 8vw, 6rem);
        }
        
        .feature {
            text-align: center;
            padding: clamp(2rem, 4vw, 3rem);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            background: white;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #d4704a, #3498db);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .feature:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .feature:hover::before {
            opacity: 1;
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        .feature h3 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            font-size: clamp(1.2rem, 2.5vw, 1.5rem);
            font-weight: 600;
        }
        
        .feature p {
            color: #666;
            font-size: clamp(0.95rem, 2vw, 1.1rem);
            line-height: 1.7;
        }

        /* About Section */
        .about-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            padding: clamp(2.5rem, 5vw, 4rem);
            margin-bottom: 2rem;
        }

        .about-section h2 {
            color: #2c3e50;
            font-size: clamp(2rem, 4vw, 2.8rem);
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 700;
        }

        .about-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            align-items: start;
        }

        .about-text p {
            color: #555;
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }

        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .disclaimer h4 {
            color: #856404;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer p {
            color: #856404;
            font-size: 0.95rem;
            margin: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            color: #d4704a;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Responsive breakpoints */
        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
            
            .nav-links {
                position: fixed;
                left: -100%;
                top: 70px;
                flex-direction: column;
                background: linear-gradient(135deg, #2c3e50, #34495e);
                width: 100%;
                text-align: center;
                transition: left 0.3s ease;
                box-shadow: 0 10px 27px rgba(0,0,0,0.3);
                padding: 1rem 0;
                gap: 0;
            }
            
            .nav-links.active {
                left: 0;
            }
            
            .nav-links li {
                padding: 0.5rem 0;
                width: 100%;
            }
            
            .nav-links a {
                display: block;
                padding: 1rem;
                width: 100%;
            }
            
            .mobile-menu-toggle {
                display: none;
            }
            
            .artifact-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 2rem;
            }
            
            .artifact-image {
                max-width: 280px;
                height: 200px;
            }

            .about-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .features {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                flex-direction: column;
                align-items: center;
            }

            .cta-button {
                width: 100%;
                max-width: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .artifact-of-day {
                padding: 2rem 1rem;
            }
            
            .content {
                padding: 2rem 1rem;
            }
            
            .features {
                gap: 1.5rem;
            }
            
            .feature {
                padding: 1.5rem;
            }
        }
        
        @media (min-width: 1200px) {
            .artifact-content {
                gap: 4rem;
            }
            
            .artifact-image {
                max-width: 400px;
                height: 280px;
            }
        }
        
        /* Footer */
        footer {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
            padding: 2rem 1rem;
            margin-top: 3rem;
            text-align: center;
        }
        
        .footer-disclaimer {
            max-width: 900px;
            margin: 0 auto 1rem;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #bdc3c7;
        }
        
        .admin-link {
            color: #bdc3c7;
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px dotted transparent;
        }
        
        .admin-link:hover {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Focus styles for accessibility */
        .nav-links a:focus,
        .mobile-menu-toggle:focus {
            outline: 2px solid #3498db;
            outline-offset: 2px;
        }

        /* Admin Modal & Permissions Panel */
        .admin-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .admin-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .admin-modal-content h2 {
            margin-bottom: 1.5rem;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input[type="email"],
        .form-group input[type="password"],
        .form-group input[type="text"] {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        .permission-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 0.8rem;
        }

        .permission-item label {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .permission-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 2rem;
            cursor: pointer;
            color: #7f8c8d;
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .user-list {
            margin-top: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .user-item {
            padding: 0.8rem;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .user-email {
            font-weight: 500;
            color: #2c3e50;
        }

        .user-perms {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        #loginForm, #permissionsPanel {
            display: none;
        }

        #loginForm.active, #permissionsPanel.active {
            display: block;
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="Archalo.html" style="text-decoration: none; color: inherit;">
                <div class="logo">Archalo</div>
            </a>
            <button class="hamburger" id="hamburger" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="Archalo.html">Home</a></li>
                <li><a href="laws.html">Laws</a></li>
                <li><a href="artifactHelp.html">I Found an Artifact</a></li>
                <li><a href="edu-resources.html">Educational Resources</a></li>
            </ul>
        </div>
    </nav>

    <section class="artifact-of-day">
        <h2>Artifact of the Day</h2>
        <div class="artifact-placeholder" id="artifact-container">
            <p class="loading">Loading today's artifact...</p>
        </div>
    </section>
    
    <section class="content">
        <!-- Hero Content Section -->
        <div class="hero-content">
            <h2>Welcome to Archalo</h2>
            <p class="hero-description">Your comprehensive guide to archaeological discovery. Found an artifact? Don't know what to do next? We'll support you through every step with location-specific guidance, legal requirements, and expert contact information.</p>
            
            <div class="quick-actions">
                <a href="artifactHelp.html" class="cta-button primary">üîç I Found an Artifact</a>
                <a href="laws.html" class="cta-button secondary">‚öñÔ∏è View Legal Guidelines</a>
            </div>
        </div>

        <!-- Features Grid -->
        <!-- About Section -->
        <div class="about-section">
            <h2>About Archalo</h2>
            <div class="about-content">
                <div class="about-text">
                    <p>Archalo is developed by the <strong>FLL Owlcheologists Team #41991</strong>, dedicated to bridging the gap between archaeological discovery and proper reporting procedures.</p>
                    
                    <p>Our platform combines real-time location data with comprehensive legal databases to provide accurate, jurisdiction-specific guidance for archaeological finds.</p>
                    
                    <div class="disclaimer">
                        <h4>‚ö†Ô∏è Important Disclaimer</h4>
                        <p>We strive to provide the most accurate data available, however, we cannot guarantee its completeness or accuracy. Our guidance is advisory only. We are not responsible for any consequences resulting from the use of this information. Always verify with authorities.</p>
                    </div>
                </div>
                
            </div>
        </div>
    </section>

    <!-- Admin Modal -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            
            <!-- Login Form -->
            <div id="loginForm" class="active">
                <h2>üîê Admin Login</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminEmail">Email</label>
                        <input type="email" id="adminEmail" placeholder="admin@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" placeholder="Enter password" required>
                    </div>
                    <div class="modal-buttons">
                        <button type="submit" class="btn btn-primary">Login</button>
                        <button type="button" class="btn btn-secondary" id="cancelLogin">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Permissions Panel (Only for admin@example.com) -->
            <div id="permissionsPanel">
                <h2>üë§ User Permissions Manager</h2>
                <p style="color: #666; margin-bottom: 1.5rem;">
                    <strong>Logged in as:</strong> <span id="currentUserEmail"></span>
                    <button class="btn btn-secondary" id="logoutBtn" style="float: right; padding: 0.5rem 1rem; font-size: 0.9rem;">Logout</button>
                </p>

                <h3 style="margin-top: 2rem;">Edit User Permissions</h3>
                <div class="form-group">
                    <label for="targetUserEmail">User Email</label>
                    <input type="email" id="targetUserEmail" placeholder="user@example.com">
                    <button class="btn btn-primary" id="loadUserBtn" style="margin-top: 0.5rem;">Load User</button>
                </div>

                <div id="permissionsForm" style="display: none; margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;">Permissions for: <span id="editingUserEmail"></span></h4>
                    
                    <div class="permission-item">
                        <label>
                            <input type="checkbox" id="permLaws" checked>
                            <span><strong>üìú Laws Admin Panel</strong> - Can access Laws admin panel</span>
                        </label>
                    </div>

                    <div class="permission-item">
                        <label>
                            <input type="checkbox" id="permDeletion" checked>
                            <span><strong>üóëÔ∏è Delete Content</strong> - Can delete laws, resources, and artifact instructions</span>
                        </label>
                    </div>

                    <div class="permission-item">
                        <label>
                            <input type="checkbox" id="permFound" checked>
                            <span><strong>üîç Found Artifact Admin Panel</strong> - Can access admin panel on "I Found an Artifact" page</span>
                        </label>
                    </div>

                    <div class="permission-item">
                        <label>
                            <input type="checkbox" id="permEdu" checked>
                            <span><strong>üìö Add Educational Resources</strong> - Can add and edit educational resources</span>
                        </label>
                    </div>

                    <div class="modal-buttons">
                        <button class="btn btn-primary" id="savePermissionsBtn">üíæ Save Permissions</button>
                        <button class="btn btn-danger" id="deletePermissionsBtn">üóëÔ∏è Delete Config</button>
                    </div>
                </div>

                <div class="user-list" id="userListContainer" style="margin-top: 2rem;">
                    <h4>Recent Users</h4>
                    <div id="userList">
                        <!-- User list will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-disclaimer">
            <p><strong>Disclaimer:</strong> We strive to provide the most accurate data available, however, we cannot guarantee its completeness or accuracy. Our guidance is advisory only. We are not responsible for any consequences resulting from the use of this information. Always verify with authorities.</p>
            <p><br>If you find an error, please report it to us. Click <a href="">here</a>.</p>
        </div>
        <a href="#" class="admin-link" id="adminLoginBtn">Login</a>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, deleteDoc, collection, getDocs, query, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCCYpXOczp5nRRP1S2Gdb1ADjIAHeJQVq0",
            authDomain: "owlcheologists.firebaseapp.com",
            projectId: "owlcheologists",
            storageBucket: "owlcheologists.firebasestorage.app",
            messagingSenderId: "323297596743",
            appId: "1:323297596743:web:c9455e40779b7c09522862",
            measurementId: "G-2CFYWTQCQ4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // ============== ADMIN AUTHENTICATION & PERMISSIONS ==============
        let currentUser = null;

        // Check auth state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                console.log('User logged in:', user.email);
                
                // Show permissions panel only for admin@example.com
                if (user.email === 'admin@example.com') {
                    showPermissionsPanel(user);
                } else {
                    alert('Access denied. Only admin@example.com can manage permissions.');
                    signOut(auth);
                }
            } else {
                currentUser = null;
                console.log('User logged out');
            }
        });

        // Modal controls
        const adminModal = document.getElementById('adminModal');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const closeModal = document.getElementById('closeModal');
        const cancelLogin = document.getElementById('cancelLogin');

        adminLoginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            adminModal.classList.add('active');
            document.getElementById('loginForm').classList.add('active');
            document.getElementById('permissionsPanel').classList.remove('active');
        });

        closeModal.addEventListener('click', () => {
            adminModal.classList.remove('active');
        });

        cancelLogin.addEventListener('click', () => {
            adminModal.classList.remove('active');
        });

        // Close modal on outside click
        adminModal.addEventListener('click', (e) => {
            if (e.target === adminModal) {
                adminModal.classList.remove('active');
            }
        });

        // Login form submission
        document.getElementById('adminLoginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value.trim();
            const password = document.getElementById('adminPassword').value;

            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                // Auth state change will handle showing the panel
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed: ' + error.message);
            }
        });

        // Show permissions panel
        function showPermissionsPanel(user) {
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('permissionsPanel').classList.add('active');
            document.getElementById('currentUserEmail').textContent = user.email;
            loadRecentUsers();
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await signOut(auth);
                adminModal.classList.remove('active');
                document.getElementById('loginForm').classList.add('active');
                document.getElementById('permissionsPanel').classList.remove('active');
                alert('Logged out successfully');
            } catch (error) {
                console.error('Logout error:', error);
                alert('Logout failed: ' + error.message);
            }
        });

        // Load user permissions
        document.getElementById('loadUserBtn').addEventListener('click', async () => {
            const email = document.getElementById('targetUserEmail').value.trim();
            if (!email) {
                alert('Please enter a user email');
                return;
            }

            try {
                const configRef = doc(db, 'config', email);
                const configSnap = await getDoc(configRef);

                document.getElementById('editingUserEmail').textContent = email;
                document.getElementById('permissionsForm').style.display = 'block';

                if (configSnap.exists()) {
                    const data = configSnap.data();
                    document.getElementById('permLaws').checked = data.laws !== false;
                    document.getElementById('permDeletion').checked = data.deletion !== false;
                    document.getElementById('permFound').checked = data.found !== false;
                    document.getElementById('permEdu').checked = data.edu !== false;
                } else {
                    // Default all to true if no config exists
                    document.getElementById('permLaws').checked = true;
                    document.getElementById('permDeletion').checked = true;
                    document.getElementById('permFound').checked = true;
                    document.getElementById('permEdu').checked = true;
                }
            } catch (error) {
                console.error('Error loading user:', error);
                alert('Error loading user: ' + error.message);
            }
        });

        // Save permissions
        document.getElementById('savePermissionsBtn').addEventListener('click', async () => {
            const email = document.getElementById('editingUserEmail').textContent;
            if (!email) {
                alert('No user loaded');
                return;
            }

            const permissions = {
                laws: document.getElementById('permLaws').checked,
                deletion: document.getElementById('permDeletion').checked,
                found: document.getElementById('permFound').checked,
                edu: document.getElementById('permEdu').checked
            };

            try {
                await setDoc(doc(db, 'config', email), permissions);
                alert(`‚úÖ Permissions saved for ${email}`);
                loadRecentUsers();
            } catch (error) {
                console.error('Error saving permissions:', error);
                alert('Error saving permissions: ' + error.message);
            }
        });

        // Delete permissions config
        document.getElementById('deletePermissionsBtn').addEventListener('click', async () => {
            const email = document.getElementById('editingUserEmail').textContent;
            if (!email) {
                alert('No user loaded');
                return;
            }

            if (!confirm(`Delete permission config for ${email}?\n\nThis will reset all permissions to default (all enabled).`)) {
                return;
            }

            try {
                await deleteDoc(doc(db, 'config', email));
                alert(`‚úÖ Permission config deleted for ${email}`);
                document.getElementById('permissionsForm').style.display = 'none';
                document.getElementById('targetUserEmail').value = '';
                loadRecentUsers();
            } catch (error) {
                console.error('Error deleting config:', error);
                alert('Error deleting config: ' + error.message);
            }
        });

        // Load recent users with configs
        async function loadRecentUsers() {
            try {
                const configQuery = query(collection(db, 'config'), limit(10));
                const querySnapshot = await getDocs(configQuery);
                
                const userListDiv = document.getElementById('userList');
                userListDiv.innerHTML = '';

                if (querySnapshot.empty) {
                    userListDiv.innerHTML = '<p style="color: #999; text-align: center;">No user configs found</p>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const email = doc.id;
                    const data = doc.data();
                    
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <div class="user-email">${email}</div>
                            <div class="user-perms">
                                Laws: ${data.laws !== false ? '‚úÖ' : '‚ùå'} | 
                                Delete: ${data.deletion !== false ? '‚úÖ' : '‚ùå'} | 
                                Found: ${data.found !== false ? '‚úÖ' : '‚ùå'} | 
                                Edu: ${data.edu !== false ? '‚úÖ' : '‚ùå'}
                            </div>
                        </div>
                    `;
                    userItem.addEventListener('click', () => {
                        document.getElementById('targetUserEmail').value = email;
                        document.getElementById('loadUserBtn').click();
                    });
                    userListDiv.appendChild(userItem);
                });
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // ============== ARTIFACT OF THE DAY ==============

        const SMITHSONIAN_API_KEY = "KKiTrGw8uKnEZTiBmCV4gBbkT3Y2KYRGjLL6gKmR";

        // Get today's date string (YYYY-MM-DD)
        function getTodayString() {
            return new Date().toISOString().split('T')[0];
        }

        // Generate deterministic random number based on date
        function getDeterministicRandom(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }

        // Get date-based seed for consistent daily selection
        function getDateSeed() {
            const today = getTodayString();
            return today.split('-').reduce((acc, part) => acc + parseInt(part), 0);
        }

        // Fetch random artifact from Smithsonian API
        async function fetchRandomArtifact() {
            try {
                // Search for Native American physical artifacts (exclude books, documents, etc.)
                const searchTopic = 'Native American AND (object OR artifact OR pottery OR basket OR tool OR weapon OR jewelry OR textile OR clothing OR ceremonial) NOT (book OR photograph OR print OR document OR manuscript OR paper OR page)';
                console.log("Searching for artifacts with topic:", searchTopic);
                
                // First, get total number of records for this topic
                const searchUrl = `https://api.si.edu/openaccess/api/v1.0/search?api_key=${SMITHSONIAN_API_KEY}&q=${encodeURIComponent(searchTopic)}&rows=0&online_media_type=Images`;
                const searchResponse = await fetch(searchUrl);
                const searchData = await searchResponse.json();
                
                if (searchData.response && searchData.response.rowCount > 0) {
                    console.log(`Found ${searchData.response.rowCount} artifacts for topic: ${searchTopic}`);
                    
                    // Get a truly random offset each time we fetch
                    // This ensures a different artifact if the database is cleared
                    const totalRecords = Math.min(searchData.response.rowCount, 10000);
                    const randomOffset = Math.floor(Math.random() * totalRecords);
                    
                    console.log(`Fetching artifact at offset ${randomOffset} of ${totalRecords}`);
                    
                    // Fetch artifact with image
                    const artifactUrl = `https://api.si.edu/openaccess/api/v1.0/search?api_key=${SMITHSONIAN_API_KEY}&q=${encodeURIComponent(searchTopic)}&rows=1&start=${randomOffset}&online_media_type=Images`;
                    const artifactResponse = await fetch(artifactUrl);
                    const artifactData = await artifactResponse.json();
                    
                    if (artifactData.response && artifactData.response.rows && artifactData.response.rows.length > 0) {
                        const artifact = artifactData.response.rows[0];
                        console.log("Raw artifact data:", artifact);
                        
                        // Extract data following the API structure
                        const content = artifact.content || {};
                        const freetext = content.freetext || {};
                        const indexedStructured = content.indexedStructured || {};
                        const descriptiveNonRepeating = content.descriptiveNonRepeating || {};
                        const onlineMedia = descriptiveNonRepeating.online_media || {};
                        
                        // Get description from notes or summary
                        let description = "No description available";
                        if (freetext.notes && freetext.notes.length > 0) {
                            // Find summary or first available note
                            const summaryNote = freetext.notes.find(note => note.label === "Summary");
                            const firstNote = freetext.notes[0];
                            description = (summaryNote || firstNote)?.content || description;
                        } else if (freetext.physicalDescription && freetext.physicalDescription.length > 0) {
                            description = freetext.physicalDescription[0].content;
                        }
                        
                        // Get image - check multiple possible locations
                        let imageUrl = "";
                        if (onlineMedia.media && onlineMedia.media.length > 0) {
                            // Try to get the highest quality image available
                            const mediaItem = onlineMedia.media[0];
                            imageUrl = mediaItem.content || mediaItem.idsId || mediaItem.thumbnail || "";
                            
                            // If we have an idsId, construct the full image URL
                            if (mediaItem.idsId && !imageUrl.startsWith('http')) {
                                imageUrl = `https://ids.si.edu/ids/deliveryService?id=${mediaItem.idsId}&max=800`;
                            }
                        }
                        
                        // Fallback: check for resources array
                        if (!imageUrl && onlineMedia.mediaCount > 0 && descriptiveNonRepeating.online_visual_material) {
                            const visualMaterial = descriptiveNonRepeating.online_visual_material;
                            if (visualMaterial.length > 0 && visualMaterial[0].idsId) {
                                imageUrl = `https://ids.si.edu/ids/deliveryService?id=${visualMaterial[0].idsId}&max=800`;
                            }
                        }
                        
                        console.log("Extracted image URL:", imageUrl);
                        
                        // Get culture information
                        let culture = "Unknown";
                        if (indexedStructured.culture && indexedStructured.culture.length > 0) {
                            culture = indexedStructured.culture.join(", ");
                        } else if (freetext.name && freetext.name.length > 0) {
                            const cultureName = freetext.name.find(n => n.label === "Culture/People" || n.label === "Culture");
                            if (cultureName) culture = cultureName.content;
                        }
                        
                        // Get date
                        let date = "Date unknown";
                        if (indexedStructured.date && indexedStructured.date.length > 0) {
                            date = indexedStructured.date.join(", ");
                        } else if (freetext.date && freetext.date.length > 0) {
                            date = freetext.date[0].content;
                        }
                        
                        // Get place/location
                        let place = "";
                        if (indexedStructured.place && indexedStructured.place.length > 0) {
                            place = indexedStructured.place.slice(0, 2).join(", ");
                        } else if (freetext.place && freetext.place.length > 0) {
                            place = freetext.place[0].content;
                        }
                        
                        const artifactObj = {
                            id: artifact.id,
                            title: artifact.title || descriptiveNonRepeating.title?.content || "Unknown Artifact",
                            description: description,
                            date: date,
                            culture: culture,
                            place: place,
                            unitCode: artifact.unitCode || "",
                            recordLink: descriptiveNonRepeating.record_link || "",
                            url: artifact.url || ""
                        };
                        
                        console.log("Processed artifact:", artifactObj);
                        return artifactObj;
                    }
                }
                throw new Error("No artifacts found");
            } catch (error) {
                console.error("Error fetching artifact:", error);
                return null;
            }
        }

        // Get or set today's artifact
        async function getTodaysArtifact() {
            const today = getTodayString();
            const docRef = doc(db, "artifactOfDay", today);
            
            try {
                console.log("Checking Firestore for artifact on date:", today);
                console.log("Project ID:", firebaseConfig.projectId);
                console.log("Document path:", `artifactOfDay/${today}`);
                
                const docSnap = await getDoc(docRef);
                console.log("Firestore read successful");
                
                if (docSnap.exists()) {
                    console.log("Found existing artifact in Firestore");
                    return docSnap.data().artifact;
                } else {
                    console.log("No document exists for today, fetching new artifact from API");
                    
                    // Fetch new artifact
                    const artifact = await fetchRandomArtifact();
                    
                    if (artifact) {
                        console.log("Fetched artifact:", artifact.title);
                        
                        // Save to Firestore
                        console.log("Saving new artifact to Firestore...");
                        const docData = { 
                            artifact: artifact, 
                            date: today,
                            timestamp: new Date().toISOString()
                        };
                        
                        await setDoc(docRef, docData);
                        console.log("Successfully saved to Firestore!");
                        
                        // Verify the save
                        const verifyDoc = await getDoc(docRef);
                        if (verifyDoc.exists()) {
                            console.log("Verification: Document exists in Firestore");
                            return verifyDoc.data().artifact;
                        } else {
                            console.warn("Verification: Document NOT found in Firestore after save");
                        }
                        
                        return artifact;
                    } else {
                        console.error("Failed to fetch artifact from API");
                        return null;
                    }
                }
            } catch (error) {
                console.error("Firestore operation failed:", error);
                console.error("Error details:", {
                    code: error.code,
                    message: error.message
                });
                
                // Check if it's a permissions error
                if (error.code === 'permission-denied') {
                    console.error("PERMISSION DENIED: Check Firestore security rules");
                    console.log("Suggested Firestore rules for testing:");
                    console.log(`
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
                    `);
                }
                
                return {
                    title: "Database Error",
                    description: "Unable to connect to database. Please check Firestore configuration and security rules.",
                    image: "",
                    date: "Unknown",
                    culture: "Unknown"
                };
            }
        }

        // Display artifact in the UI
        function displayArtifact(artifact) {
            const container = document.getElementById('artifact-container');
            
            if (!artifact) {
                container.innerHTML = '<p class="loading">Unable to load artifact. Please try again later.</p>';
                return;
            }

            // Build the HTML for artifact display
            let artifactHTML = '<div class="artifact-content"><div>';
            
            // Banner section
            artifactHTML += '<div class="artifact-image" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: 700; text-align: center; padding: 2rem; letter-spacing: 2px;">ARTIFACT OF THE DAY</div>';
            
            artifactHTML += '</div><div class="artifact-info">';
            
            // Title
            artifactHTML += `<h3>${artifact.title}</h3>`;
            
            // Culture
            if (artifact.culture && artifact.culture !== "Unknown") {
                artifactHTML += `<p><strong>Culture:</strong> ${artifact.culture}</p>`;
            }
            
            // Date
            if (artifact.date && artifact.date !== "Date unknown") {
                artifactHTML += `<p><strong>Date:</strong> ${artifact.date}</p>`;
            }
            
            // Place
            if (artifact.place) {
                artifactHTML += `<p><strong>Location:</strong> ${artifact.place}</p>`;
            }
            
            // Unit/Museum
            if (artifact.unitCode) {
                artifactHTML += `<p><strong>Collection:</strong> ${artifact.unitCode}</p>`;
            }
            
            // Description
            if (artifact.description && artifact.description !== "No description available") {
                const maxLength = 300;
                const truncatedDesc = artifact.description.length > maxLength 
                    ? artifact.description.substring(0, maxLength) + '...' 
                    : artifact.description;
                artifactHTML += `<p><strong>Description:</strong> ${truncatedDesc}</p>`;
            }
            
            // Link to full record - use record_link or construct from URL
            // The Smithsonian URL structure has changed, so we'll use a search-based approach
            let recordUrl;
            if (artifact.url && artifact.url.includes('http')) {
                // Use the artifact URL if it's a full URL
                recordUrl = artifact.url;
            } else if (artifact.recordLink && artifact.recordLink.includes('http')) {
                // Only use recordLink if it's already a full URL
                recordUrl = artifact.recordLink;
            } else if (artifact.title) {
                // Search for the artifact by title on Smithsonian collections
                // This is more reliable than trying to construct object URLs
                recordUrl = `https://collections.si.edu/search/?q=${encodeURIComponent(artifact.title)}`;
            } else if (artifact.id) {
                // Last resort: search by ID
                recordUrl = `https://collections.si.edu/search/?q=${encodeURIComponent(artifact.id)}`;
            }
            
            if (recordUrl) {
                artifactHTML += `<p style="margin-top: 1.5rem;">
                    <a href="${recordUrl}" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       style="display: inline-block; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #3498db, #2980b9); color: white; text-decoration: none; font-weight: 600; border-radius: 8px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);"
                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(52, 152, 219, 0.4)';"
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(52, 152, 219, 0.3)';">
                       View Full Record on Smithsonian ‚Üí
                    </a>
                </p>`;
            }
            
            artifactHTML += '</div></div>';
            container.innerHTML = artifactHTML;
        }

        // Initialize artifact of the day
        async function initArtifactOfDay() {
            try {
                console.log("Starting artifact initialization...");
                const artifact = await getTodaysArtifact();
                console.log("Artifact received:", artifact);
                displayArtifact(artifact);
            } catch (error) {
                console.error("Error initializing artifact:", error);
                const container = document.getElementById('artifact-container');
                container.innerHTML = '<p class="loading">Error loading artifact. Please refresh the page.</p>';
            }
        }

        // Load artifact when page loads
        window.addEventListener('DOMContentLoaded', () => {
            console.log("Page loaded, initializing artifact...");
            initArtifactOfDay();
        });

        // ============== HAMBURGER MENU ==============
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        
        if (hamburger) {
            hamburger.addEventListener('click', function() {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });
            
            // Close menu when clicking on a link
            const navLinkItems = navLinks.querySelectorAll('a');
            navLinkItems.forEach(link => {
                link.addEventListener('click', function() {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                });
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                const isClickInsideNav = navLinks.contains(event.target);
                const isClickOnHamburger = hamburger.contains(event.target);
                
                if (!isClickInsideNav && !isClickOnHamburger && navLinks.classList.contains('active')) {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });
        }
        // ============== END HAMBURGER MENU ==============
    </script>
</body>
</html>